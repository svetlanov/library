# novac_kursovaya_spring

## Описание
Это приложение для управления библиотекой, разработанное с использованием Spring Boot. Оно предоставляет функционал для работы с книгами, пользователями и их взаимодействиями, включая регистрацию, аутентификацию, добавление книг пользователям и поиск книг.

## Функционал
- **Регистрация и аутентификация пользователей** с использованием JWT.
- **Управление книгами**: добавление, поиск по жанру, автору, году и названию.
- **Управление книгами пользователей**: добавление и удаление книг из списка пользователя.
- **Глобальная обработка исключений**.

## Технологии
- **Spring Boot**: основной фреймворк.
- **Spring Security**: для аутентификации и авторизации.
- **JWT (JSON Web Token)**: для управления сессиями.
- **Spring Data JPA**: для работы с базой данных.
- **PostgreSQL**: база данных.
- **Lombok**: для упрощения написания кода.

## Установка и запуск

### Предварительные требования
- Установленный **Java 21**.
- Установленный **PostgreSQL**.
- Установленный **Maven**.

### Настройка базы данных
1. Создайте базу данных `library` в PostgreSQL.
2. Убедитесь, что настройки подключения в файле [`application.properties`](src/main/resources/application.properties) соответствуют вашей базе данных:
   ```properties
   spring.datasource.url=jdbc:postgresql://localhost:5432/library
   spring.datasource.username=ваш_пользователь
   spring.datasource.password=ваш_пароль
   ```

## Структура таблиц базы данных

### Таблица `books`
Хранит информацию о книгах в библиотеке.

**SQL для создания таблицы:**
```sql
CREATE TABLE public.books (
    id int8 GENERATED BY DEFAULT AS IDENTITY( 
        INCREMENT BY 1 
        MINVALUE 1 
        MAXVALUE 9223372036854775807 
        START 1 
        CACHE 1 
        NO CYCLE
    ) NOT NULL,
    author varchar(255) NULL,
    genre varchar(255) NULL,
    title varchar(255) NOT NULL,
    "year" int4 NOT NULL,
    CONSTRAINT books_pkey PRIMARY KEY (id)
);
```

**Описание полей:**
- **`id`** — уникальный идентификатор книги. Генерируется автоматически и используется как первичный ключ.
- **`author`** — имя автора книги. Поле может быть пустым, если автор неизвестен.
- **`genre`** — жанр книги. Поле может быть пустым, если жанр не указан.
- **`title`** — название книги. Обязательное поле, не может быть пустым.
- **`year`** — год издания книги. Обязательное поле, должно содержать числовое значение.

### Таблица `users`
Хранит информацию о пользователях приложения.

**SQL для создания таблицы:**
```sql
CREATE TABLE public.users (
    id int8 GENERATED BY DEFAULT AS IDENTITY( 
        INCREMENT BY 1 
        MINVALUE 1 
        MAXVALUE 9223372036854775807 
        START 1 
        CACHE 1 
        NO CYCLE
    ) NOT NULL,
    "password" varchar(255) NOT NULL,
    username varchar(255) NOT NULL,
    "role" varchar(255) NULL,
    CONSTRAINT ukr43af9ap4edm43mmtq01oddj6 UNIQUE (username),
    CONSTRAINT users_pkey PRIMARY KEY (id)
);
```

**Описание полей:**
- **`id`** — уникальный идентификатор пользователя. Генерируется автоматически и используется как первичный ключ.
- **`password`** — пароль пользователя. Обязательное поле.
- **`username`** — имя пользователя. Обязательное поле, должно быть уникальным.
- **`role`** — роль пользователя в системе (например, администратор или обычный пользователь). Поле может быть пустым.


### Таблица `user_books`
Хранит информацию о связях между пользователями и книгами.

**SQL для создания таблицы:**
```sql
CREATE TABLE public.user_books (
    id int8 GENERATED BY DEFAULT AS IDENTITY( 
        INCREMENT BY 1 
        MINVALUE 1 
        MAXVALUE 9223372036854775807 
        START 1 
        CACHE 1 
        NO CYCLE
    ) NOT NULL,
    book_id int8 NULL,
    user_id int8 NULL,
    CONSTRAINT user_books_pkey PRIMARY KEY (id)
);
```

**Описание полей:**
- **`id`** — уникальный идентификатор записи. Генерируется автоматически и используется как первичный ключ.
- **`book_id`** — идентификатор книги. Поле связано с таблицей `books`.
- **`user_id`** — идентификатор пользователя. Поле связано с таблицей `users`.

**Внешние ключи:**
```sql
ALTER TABLE public.user_books 
ADD CONSTRAINT fka26s0po2ld5t5mi5sww9ca98 FOREIGN KEY (book_id) REFERENCES public.books(id);

ALTER TABLE public.user_books 
ADD CONSTRAINT fkseruwi8quqdx6svnurcamej55 FOREIGN KEY (user_id) REFERENCES public.users(id);
```

## Postman коллекция
Для удобного тестирования API предоставляется Postman коллекция. Вы можете импортировать её в Postman и использовать для выполнения запросов к серверу.

**Шаги для использования:**
1. Откройте Postman.
2. Импортируйте коллекцию, находящуюся в файле [`Java%20Curs%20Library.postman_collection.json`](Java%20Curs%20Library.postman_collection.json) в корне проекта.

Файл `Java%20Curs%20Library.postman_collection.json` содержит примеры запросов для всех основных эндпоинтов приложения, включая:
- Регистрацию и аутентификацию пользователей.
- Управление книгами.
- Управление списком книг пользователей.

## Эндпоинты API

### Пользователи
- **POST /api/auth/register** — регистрация нового пользователя.
- **POST /api/auth/login** — аутентификация пользователя и получение JWT токена.

### Книги
- **GET /api/books** — получение списка всех книг.
- **GET /api/books/genre/{genre}** — получение списка книг по жанру.
- **GET /api/books/search** - поиск книг по фильтрам.
- **POST /api/books** — добавление новой книги.

### Управление книгами пользователей
- **POST /api/user/addBook** — добавление книги в список пользователя.
- **POST /api/user/removeBook** — удаление книги из списка пользователя.
- **GET /api/user** — получение списка книг, добавленных пользователем.

### Пример использования
Для тестирования эндпоинтов вы можете использовать Postman коллекцию, описанную в разделе [Postman коллекция](#postman-коллекция).



